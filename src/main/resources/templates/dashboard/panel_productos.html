<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Productos - Grupo Antonio</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/inicio-dashboardEstilos.css}"> 
    
    <style>
        /* Mejora del efecto hover existente: Añadir un brillo suave */
.boton-perfil-rojo:hover {
    background-color: #b71c1c; /* Color más oscuro */
    transform: translateY(-2px); /* Eleva el botón ligeramente */
    
    /* Efecto de sombra roja sutil (el "Glow") */
    box-shadow: 0 8px 15px rgba(211, 47, 47, 0.5); 
    
    /* Añadir transición para que el cambio de sombra sea suave */
    transition: all 0.3s ease;
}
        /* --- ESTILOS GENERALES --- */
        .btn-new { background: #e60000; color: white; border: none; padding: 8px 20px; border-radius: 6px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: 0.3s; box-shadow: 0 4px 10px rgba(230,0,0,0.2); }
        .btn-new:hover { background: #cc0000; transform: translateY(-2px); }
        .header-actions { display: flex; gap: 10px; }
        
        /* --- FILTROS --- */
        .filters-bar { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 15px; margin-bottom: 25px; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); align-items: center; }
        .filter-input-group { position: relative; background: #f8f9fa; border-radius: 8px; padding: 5px 15px; display: flex; align-items: center; border: 1px solid #eee; }
        .filter-input-group i { color: #999; margin-right: 10px; }
        .filter-input { border: none; background: transparent; width: 100%; padding: 10px 0; outline: none; font-size: 0.9rem; color: #555; }
        .filter-select { width: 100%; border: none; background: transparent; padding: 10px 0; outline: none; color: #555; cursor: pointer; }

        /* --- GRID DE TARJETAS --- */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); 
            gap: 25px; padding-bottom: 40px;
        }

        .product-card {
            background: white; border-radius: 16px; overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid #f0f0f0;
            display: flex; flex-direction: column; position: relative;
        }

        .product-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }

        .card-img-container {
            height: 180px; width: 100%; background: #f9f9f9;
            display: flex; align-items: center; justify-content: center;
            position: relative; border-bottom: 1px solid #eee;
        }

        .card-img { max-width: 80%; max-height: 90%; object-fit: contain; }

        .card-badge-id {
            position: absolute; top: 10px; left: 10px;
            background: rgba(0,0,0,0.6); color: white;
            padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 600;
        }

        .card-body { padding: 20px; flex: 1; display: flex; flex-direction: column; }
        .card-category { font-size: 0.75rem; color: #e60000; font-weight: 600; text-transform: uppercase; margin-bottom: 5px; }
        .card-title { font-size: 1rem; font-weight: 700; color: #333; margin: 0 0 5px 0; line-height: 1.3; }
        .card-unit { font-size: 0.8rem; color: #888; margin-bottom: 15px; }

        .card-details {
            display: flex; justify-content: space-between; align-items: center;
            margin-top: auto; padding-top: 15px; border-top: 1px dashed #eee;
        }
        .card-price { font-size: 1.1rem; font-weight: 800; color: #333; }
        .card-stock { font-size: 0.85rem; color: #555; background: #f0f0f0; padding: 4px 10px; border-radius: 20px; }

        /* --- ACCIONES Y ESTADO --- */
        .card-footer {
            padding: 15px 20px; background: #fcfcfc; border-top: 1px solid #f0f0f0;
            display: flex; justify-content: space-between; align-items: center;
        }
        .card-actions { display: flex; gap: 8px; }
        .btn-icon {
            width: 35px; height: 35px; border-radius: 8px; border: none;
            cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s;
        }
        .btn-edit { background: #e3f2fd; color: #3498db; }
        .btn-edit:hover { background: #3498db; color: white; }
        .btn-delete { background: #ffebee; color: #e74c3c; }
        .btn-delete:hover { background: #e74c3c; color: white; }

        /* SWITCH */
        .switch { position: relative; display: inline-block; width: 40px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #2ecc71; }
        input:checked + .slider:before { transform: translateX(20px); }

        /* --- MODAL --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); display: flex; justify-content: center; align-items: center; z-index: 2000; opacity: 0; pointer-events: none; transition: 0.3s ease; backdrop-filter: blur(3px); }
        .modal-overlay.active { opacity: 1; pointer-events: all; }
        .modal-content { background: white; padding: 30px; border-radius: 16px; width: 600px; max-width: 95%; transform: translateY(-20px); transition: 0.3s ease; }
        .modal-overlay.active .modal-content { transform: translateY(0); }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px; }
        .full-width { grid-column: span 2; }
        .form-group label { display: block; font-size: 0.85rem; color: #666; margin-bottom: 5px; }
        .form-control { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; outline: none; }
        .modal-buttons { display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px; }
        .btn-modal { padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; font-weight: 500; }
        .btn-cancel { background: #f1f1f1; }
        .btn-save { background: #e60000; color: white; }

        /* Modal Eliminar */
        .modal-delete .modal-content { width: 400px; text-align: center; }
        .modal-icon-delete { font-size: 3rem; color: #e74c3c; margin-bottom: 15px; }
        .btn-confirm-delete { background: #e74c3c; color: white; }

        @media (max-width: 768px) { .filters-bar { grid-template-columns: 1fr; } .products-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="modal-overlay" id="productoModal">
    <div class="modal-content">
        <h3 id="modalTitle" style="margin:0; color:#333;">Nuevo Producto</h3>
        <form th:action="@{/usuario/producto/guardar}" method="post" enctype="multipart/form-data">
            <input type="hidden" id="prodId" name="id">
            <div class="form-grid">
                
                <div class="form-group full-width">
                    <label>Nombre</label>
                    <input type="text" id="prodNombre" name="nombre" class="form-control" required>
                </div>
                
                <div class="form-group full-width">
                    <label>Descripción</label>
                    <textarea id="prodDescripcion" name="descripcion" class="form-control" rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Categoría</label>
                    <select id="prodCategoria" name="categoria" class="form-control">
                        <option value="Herramientas">Herramientas</option>
                        <option value="Bandejas">Bandejas</option>
                        <option value="Accesorios">Accesorios</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Precio (S/)</label>
                    <input type="number" id="prodPrecio" name="precio" class="form-control" step="0.01" required>
                </div>
                <div class="form-group">
                    <label>Stock</label>
                    <input type="number" id="prodCantidad" name="cantidad" class="form-control" required>
                </div>
                <div class="form-group">
                    <label>Unidad</label>
                    <input type="text" id="prodUnidad" name="unidad" class="form-control">
                </div>
                <div class="form-group">
                    <label>Estado</label>
                    <select id="prodEstadoSelect" name="estado" class="form-control">
                        <option value="Activo">Activo</option>
                        <option value="Inactivo">Inactivo</option>
                    </select>
                </div>
                
                <div class="form-group full-width">
                    <label>Imagen</label>
                    <input type="file" name="file" class="form-control" accept="image/*">
                </div>
            </div>
            <div class="modal-buttons">
                <button type="button" class="btn-modal btn-cancel" onclick="cerrarModal('productoModal')">Cancelar</button>
                <button type="submit" class="btn-modal btn-save">Guardar</button>
            </div>
        </form>
    </div>
</div>

    <div class="modal-overlay modal-delete" id="deleteModal">
        <div class="modal-content">
            <div class="modal-icon-delete"><i class="fas fa-trash-alt"></i></div>
            <h3>¿Eliminar producto?</h3>
            <p style="color:#666; margin-bottom:20px;">Esta acción no se puede deshacer.</p>
            <div class="modal-buttons" style="justify-content: center;">
                <button class="btn-modal btn-cancel" onclick="cerrarModal('deleteModal')">Cancelar</button>
                <button class="btn-modal btn-confirm-delete" id="btnConfirmDelete">Eliminar</button>
            </div>
        </div>
    </div>

    <div id="toast-container"></div>

 <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
<div class="logo">
    <a href="/" style="text-decoration: none; color: inherit;"> 
        <span class="logo-grupo">GRUPO</span>
        <span class="logo-antonio">ANTONIO</span>
    </a>
</div>            <button class="toggle-sidebar" id="toggleSidebar"><i class="fas fa-bars"></i></button>
        </div>
       <nav class="sidebar-nav">

    <div th:if="${rolUsuario == 'ADMIN'}">
        <p class="menu-label">Administración</p>
        
        <a href="/usuario/dashboard" class="nav-item" 
           th:classappend="${activePage == 'dashboard'} ? 'active'">
           <i class="fas fa-chart-line"></i><span>Dashboard</span>
        </a>

        <a href="/usuario/panel_usuario" class="nav-item" 
           th:classappend="${activePage == 'usuarios'} ? 'active'">
           <i class="fas fa-users-cog"></i><span>Usuarios</span>
        </a>

        <a href="/usuario/panel_productos" class="nav-item" 
           th:classappend="${activePage == 'productos'} ? 'active'">
           <i class="fas fa-box"></i><span>Productos</span>
        </a>
    </div>

    <div th:if="${rolUsuario == 'ADMIN' or rolUsuario == 'VENDEDOR'}">
        <p class="menu-label" th:if="${rolUsuario == 'VENDEDOR'}">Área de Ventas</p>

        <a href="/usuario/pedidos" class="nav-item" 
           th:classappend="${activePage == 'pedidos'} ? 'active'">
           <i class="fas fa-shopping-cart"></i><span>Pedidos</span>
        </a>
    </div>

    <div th:if="${rolUsuario == 'ADMIN' or rolUsuario == 'USUARIO' or rolUsuario == 'USER'}">
        <p class="menu-label" th:if="${rolUsuario != 'ADMIN'}">Mi Cuenta</p>
        
        <a href="/usuario/seguimiento" class="nav-item" 
           th:classappend="${activePage == 'seguimiento'} ? 'active'">
           <i class="fas fa-truck"></i><span>Mis Pedidos</span>
        </a>

        <a href="/" class="nav-item" th:if="${rolUsuario != 'ADMIN'}">
            <i class="fas fa-store"></i><span>Ir a Tienda</span>
        </a>
    </div>

    <div class="nav-spacer"></div>
    
    <a href="/usuario/logout" class="nav-item">
        <i class="fas fa-sign-out-alt"></i><span>Cerrar Sesión</span>
    </a>

</nav>
        <div class="sidebar-footer">
            <div class="sidebar-user-box">
                <h4 class="sidebar-user-name" th:text="${nombreUsuario}">Usuario</h4>
                <p class="sidebar-user-status"><span class="status-dot"></span> Online</p>
            </div>
        </div>
    </aside>


    <main class="main-content">
        <div class="welcome-message" style="margin-bottom: 20px;">
            <div class="user-section">
                <h2 style="margin: 0; font-size: 1.5rem; color: #333;">
                    Inventario <span style="font-size: 0.7em; background: #eee; padding: 2px 10px; border-radius: 20px; margin-left: 10px;"><i class="fas fa-box"></i> <span th:text="${totalProductos}">0</span></span>
                </h2>
            </div>
            <div class="header-actions">
                <button class="btn-new" onclick="abrirModalCrear()"><i class="fas fa-plus"></i> Nuevo</button>
                </div>
        </div>

        <div class="filters-bar">
            <div class="filter-input-group">
                <i class="fas fa-barcode"></i>
                <input type="text" id="searchCodigo" class="filter-input" placeholder="Buscar ID...">
            </div>
            <div class="filter-input-group">
                <i class="fas fa-search"></i>
                <input type="text" id="searchNombre" class="filter-input" placeholder="Buscar nombre...">
            </div>
            <div class="filter-input-group">
                <i class="fas fa-layer-group"></i>
                <select class="filter-select" id="filterCategoria">
                    <option value="">Categorías</option>
                    <option value="Herramientas">Herramientas</option>
                    <option value="Bandejas">Bandejas</option>
                    <option value="Accesorios">Accesorios</option>
                </select>
            </div>
            <div class="filter-input-group">
                <i class="fas fa-toggle-on"></i>
                <select class="filter-select" id="filterEstado">
                    <option value="">Estados</option>
                    <option value="Activo">Activo</option>
                    <option value="Inactivo">Inactivo</option>
                </select>
            </div>
        </div>

        <div class="products-grid" id="gridProductos">
            <div class="product-card" 
                 th:each="prod : ${listaProductos}" 
                 th:id="'card-' + ${prod.id}"
                 th:data-categoria="${prod.categoria}" 
                 th:data-estado="${prod.estado}">
                
                <div class="card-img-container">
                    <span class="card-badge-id" th:text="'#' + ${prod.id}">#1</span>
                    <img th:src="@{${prod.imagenUrl}}" alt="Img" class="card-img" onerror="this.src='https://via.placeholder.com/150?text=Sin+Imagen'">
                </div>

                <div class="card-body">
                    <span class="card-category" th:text="${prod.categoria}">CAT</span>
                    <h4 class="card-title" th:text="${prod.nombre}">Nombre</h4>
                    <span class="card-unit" th:text="${prod.unidad}">Unid</span>
                    
                    <div class="card-details">
                        <span class="card-price" th:text="'S/ ' + ${prod.precio}">S/ 0</span>
                        <span class="card-stock"><i class="fas fa-boxes"></i> <span th:text="${prod.cantidad}">0</span></span>
                    </div>
                </div>

                <div class="card-footer">
                    <label class="switch" title="Cambiar Estado">
                        <input type="checkbox" th:checked="${prod.estado == 'Activo'}" th:onchange="'toggleEstado(' + ${prod.id} + ', this)'">
                        <span class="slider round"></span>
                    </label>

                    <div class="card-actions">
                        <button class="btn-icon btn-edit" 
        th:data-id="${prod.id}"
        th:data-nombre="${prod.nombre}"
        th:data-precio="${prod.precio}"
        th:data-cantidad="${prod.cantidad}"
        th:data-unidad="${prod.unidad}"
        th:data-categoria="${prod.categoria}"
        th:data-estado="${prod.estado}"
        th:data-descripcion="${prod.descripcion}" onclick="abrirModalEditar(this)">
    <i class="fas fa-pen"></i>
</button>
                        <button class="btn-icon btn-delete" 
                                th:onclick="'abrirModalEliminar(' + ${prod.id} + ')'">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <div th:if="${#lists.isEmpty(listaProductos)}" style="grid-column: 1/-1; text-align: center; padding: 50px; color: #999;">
                <i class="fas fa-box-open" style="font-size: 3rem; margin-bottom: 15px;"></i>
                <p>No hay productos registrados.</p>
            </div>
        </div>
    </main>

    <script>
// --- MODALES ---
const modalProd = document.getElementById('productoModal');
// ... otras variables de modal ...
const inpUnidad = document.getElementById('prodUnidad');
const inpCategoria = document.getElementById('prodCategoria');
const inpEstado = document.getElementById('prodEstadoSelect');

// ✅ AÑADIDO: Nueva variable para la descripción
const inpDescripcion = document.getElementById('prodDescripcion'); 
let idEliminar = null;

// ...

function abrirModalCrear() {
    modalTitle.textContent = "Nuevo Producto";
    // ... limpiando otros campos ...
    inpUnidad.value = ''; 
    inpEstado.value = 'Activo';
    // ✅ Limpiar descripción
    inpDescripcion.value = ''; 
    modalProd.classList.add('active');
}

function abrirModalEditar(btn) {
    modalTitle.textContent = "Editar Producto";
    inpId.value = btn.getAttribute('data-id');
    inpNombre.value = btn.getAttribute('data-nombre');
    inpPrecio.value = btn.getAttribute('data-precio');
    inpCantidad.value = btn.getAttribute('data-cantidad');
    inpUnidad.value = btn.getAttribute('data-unidad');
    inpCategoria.value = btn.getAttribute('data-categoria');
    inpEstado.value = btn.getAttribute('data-estado');
    // ✅ Llenar descripción
    inpDescripcion.value = btn.getAttribute('data-descripcion');
    modalProd.classList.add('active');
}
</script>   
</body>
</html>